stages:
  - compile
  - test
  - build
  - image-build
  - code_quality
  - artifacts
  - deploy

compile:
  stage: compile
  tags:
  - minikibe
  script:
    - mvn compile

test:
  stage: test
  tags:
  - minikibe
  script:
    - mvn test

build:
  stage: build
  tags:
  - minikibe
  script:
    - mvn package -Dmaven.test.skip=true
  artifacts:
   paths:
   - target/*.war

docker:
  stage: image-build
  tags:
  - minikibe
  script:
    - ls
    - docker login --username=anjreddy --password=Adiyog!@112
    - docker build -t anjreddy/wipro:latest .
    - docker push anjreddy/wipro:latest


sonar:
  stage: code_quality
  tags:
  - minikibe
  script:
    - mvn sonar:sonar -Dsonar.host.url=http://34.229.119.25:9000 -Dsonar.login=37e516b7aa7cbebcdf761996af4fd158a7f58c97

nexus:
  stage: artifacts
  tags:
  - minikibe
  script:
   - mvn deploy


deploy-prod:
  stage: deploy
  tags:
  - minikibe
  only:
    - master
  script: 
    - kubectl apply -f Deployment.yml
  

   
    
