tags:
  - k8

stages:
  - compile
  - test
  - build
  - code_quality
  - artifacts
  - image-build
  - deploy

compile:
  stage: compile
  script:
    - mvn compile

test:
  stage: test
  script:
    - mvn test

build:
  stage: build
  script:
    - mvn package -Dmaven.test.skip=true


sonar:
  stage: code_quality
  script:
    - mvn sonar:sonar -Dsonar.host.url=http://ec2-18-212-121-17.compute-1.amazonaws.com:9000 \
  -Dsonar.login=6b2a5591e54dc65356961719918f6af2edf0a3d7

Nexus:
  stage: artifacts
  script:
    - mvn deploy

docker:
  stage: image-build
  script:
    - docker build -it .

Kubernetes:
  stage: deploy
  script:
    - kubectl apply -f deployment.yml
