stages:
  - compile
  - test
  - build
  - image-build
  - code_quality
  - artifacts
  - deploy

compile:
  stage: compile
  tags:
  - allinone
  script:
    - mvn compile

test:
  stage: test
  tags:
  - allinone
  script:
    - mvn test

build:
  stage: build
  tags:
  - allinone
  script:
    - mvn package -Dmaven.test.skip=true
  artifacts:
   paths:
   - target/*.war

docker:
  stage: image-build
  tags:
  - allinone
  script:
    - docker login --username=anjreddy --password=Adiyog!@112
    - docker build -t anjreddy/wipro:latest .
    - docker push anjreddy/wipro:latest


sonar:
  stage: code_quality
  tags:
  - allinone
  script:
    - mvn sonar:sonar -Dsonar.host.url=http://ec2-34-229-119-25.compute-1.amazonaws.com:9000 -Dsonar.login=93fb8a0ea73e3ed4a74bc4440cb6190ce82d900d

nexus:
  stage: artifacts
  tags:
  - allinone
  script:
   - mvn deploy

deploy-prod:
  image: bitnami/kubectl:latest
  stage: deploy
  only:
    - master
  when: manual
  script: kubectl apply -f deployment.yaml
  

   
    